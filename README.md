# AccountService

## Содержание

- [Описание проекта](#описание)
- [Технологии](#технологии)
- [Требования](#требования)
- [Как запустить](#как-запустить)
- [Структура проекта](#структура-проекта)
- [Описание API](#описание-api)

---

## Описание

Микросервис для управления банковскими счетами в розничном банке. Сервис предоставляет REST API для создания, редактирования, удаления счетов, регистрации транзакций, переводов между счетами и получения выписок. Основные сценарии включают открытие текущих и депозитных счетов, пополнение счетов, переводы и мониторинг баланса.

---

## Технологии

- .NET 9 / ASP.NET Core Web API

- AutoMapper — для автоматического сопоставления моделей

- FluentValidation — для валидации входящих данных

- MediatR — реализация паттерна CQRS / Mediator

- Swagger/OpenAPI — генерация Swagger UI для документации API

---

## Требования

.NET SDK 9 или новее

Visual Studio 2022 или возможность запуска из командной строки с dotnet CLI

---

## Как запустить

### В Visual Studio 2022
1. Клонируйте репозиторий.
2. Откройте решение в Visual Studio 2022.
3. Запустите проект через Debug (F5) или без отладки (Ctrl+F5).
4. Откройте Swagger UI по адресу http://localhost:5177/swagger для тестирования API.

### Через командную строку
1. Клонируйте репозиторий:
```bash
git clone https://github.com/turbo821/AccountService.git
```
2. Перейдите в каталог проекта:
```bash
cd ./AccountService/AccountService
```
3. Соберите проект:
```bash
dotnet build
```
4. Запустите проект:
```bash
dotnet run
```
5. Откройте Swagger UI по адресу http://localhost:5177/swagger для тестирования API.
---

## Структура проекта

- **`Features`**
  * Содержит список директорий для каждого слайса, содержащий общий функционал для конкретной сущности.
- **`Features/Accounts`**
  * Содержит модели, интерфейсы и компоненты MediatR, связанные с `Account`.
- **`Exceptions`**
  * Содержит кастомные исключения.
- **`Infrastructure`**
  * Содержит реализацию сервисов, связанных со внешними источниками.
- **`Middlewares`**
  * Содержит middlewares, используемые для обработки запросов/ответов.

---

## Описание API

### 1. Создание счёта
*   **Endpoint:** `POST /accounts`
*   **Описание:** Создаёт новый банковский счёт с нулевым балансом.
*   **Тело запроса:**
```json
{
  "ownerId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "type": "Deposit",
  "currency": "RUB",
  "interestRate": 2
}
``` 
*   **Успешный ответ:** `200 OK`.
```json
{
  "accountId": "11329a35-0c15-4191-aff7-c59c8e395614"
}
```

### 2. Получение список счётов
*   **Endpoint:** `GET /accounts`
*   **Описание:** Возвращает список всех открытых счетов.
*   **Тело запроса:** Пустое
*   **Успешный ответ:** `200 OK`.
```json
[
  {
    "id": "55dcfa45-03e0-49ae-9cce-44b167251328",
    "ownerId": "f6af2260-9c81-4178-98f5-696742700fa6",
    "type": "Checking",
    "currency": "USD",
    "balance": 1000,
    "interestRate": null,
    "openedAt": "2025-07-28T00:52:18.5161679Z"
  }
]
```

### 3. Получение счёта по ID
*   **Endpoint:** `GET /accounts/{id}`
*   **Описание:** Возвращает информацию о конкретном счёте по его ID.
*   **Тело запроса:** Пустое
*   **Успешный ответ:** `200 OK`.
```json
{
  "id": "55dcfa45-03e0-49ae-9cce-44b167251328",
  "ownerId": "f6af2260-9c81-4178-98f5-696742700fa6",
  "type": "Checking",
  "currency": "USD",
  "balance": 1000,
  "interestRate": null,
  "openedAt": "2025-07-28T00:52:18.5161679Z"
}
```

### 4. Изменение процентной ставки счёта
*   **Endpoint:** `PATCH /accounts/{id}/interest-rate`
*   **Описание:** Обновляет процентную ставку по счёту.
*   **Тело запроса:**
```json
{
  "interestRate": 3
}
```
*   **Успешный ответ:** `200 OK`.

### 5. Закрытие счёта (мягкое удаление)
*   **Endpoint:** `DELETE /accounts/{id}`
*   **Описание:** Закрывает счёт по его ID. Альтернатива мягкого удаления.
*   **Тело запроса:** Пустое
*   **Успешный ответ:** `200 OK`.
```json
{
  "accountId": "55dcfa45-03e0-49ae-9cce-44b167251328"
}
```

### 6. Регистрация транзакции по счёту
*   **Endpoint:** `POST /accounts/{accountId}/transactions`
*   **Описание:** Регистрирует транзакцию по счёту (пополнение или списание).
*   **Тело запроса:**
```json
{
  "amount": 100,
  "currency": "USD",
  "type": "Debit",
  "description": "hello"
}
```
*   **Успешный ответ:** `200 OK`.
```json
{
  "transactionId": "dad8ebfd-52d5-4c5f-b70d-527c5502ecf2"
}
```

### 7. Выполнение перевода между счётами
*   **Endpoint:** `POST /accounts/transfer`
*   **Описание:** Переводит средства между двумя счетами. Регистрация по одной транзакций (пополнение или списание) для обоих счетов.
*   **Тело запроса:**
```json
{
  "fromAccountId": "0e294688-657f-4f3f-a59a-1d5de8c48bde",
  "toAccountId": "cb69a295-b13f-43d8-bca5-c8a99b5f04ff",
  "amount": 5000,
  "currency": "RUB",
  "description": "happy birthday"
}
```
*   **Успешный ответ:** `200 OK`.

### 8. Выдача выписки клиенту по счету
*   **Endpoint:** `GET /accounts/{accountId}/transactions`
*   **Описание:** Возвращает список транзакций по счёту.
*   **Тело запроса:** Пустое
*   **Успешный ответ:** `200 OK`.
```json
{
  "accountId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "ownerId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "type": "Checking",
  "balance": 0,
  "transactions": [
    {
      "transactionId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "counterpartyAccountId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
      "amount": 0,
      "currency": "string",
      "type": "Debit",
      "description": "string",
      "timestamp": "2025-07-28T01:09:26.544Z"
    }
  ]
}
```

### 9. Проверка наличия счёта у клиента
*   **Endpoint:** `GET /accounts/owner/{ownerId}`
*   **Описание:** Проверяет наличие счетов у владельца.
*   **Тело запроса:** Пустое
*   **Успешный ответ:** `200 OK`.
```json
{
  "ownerId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "accountExists": true,
  "accountIds": [
    "11329a35-0c15-4191-aff7-c59c8e395614"
  ]
}
```

---
